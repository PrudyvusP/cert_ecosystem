# cert_ecosystem

CERT_ecosystem - это сервис учета взаимодействия с юридическими лицами (организациями).
Основная бизнес-логика:
* с организацией может вестись рабочая переписка (Message);
* у организации могут быть информационные ресурсы (Resource), у которых может быть сфера(-ы) функционирования (Industry),
* организация может иметь организационно-распорядительные документы (OrgAdmDoc).
* организацию можно добавлять как вручную, так и с помощью 
[Единого государственного реестра юридических лиц (ЕГРЮЛ)](https://ru.wikipedia.org/wiki/%D0%95%D0%B4%D0%B8%D0%BD%D1%8B%D0%B9_%D0%B3%D0%BE%D1%81%D1%83%D0%B4%D0%B0%D1%80%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9_%D1%80%D0%B5%D0%B5%D1%81%D1%82%D1%80_%D1%8E%D1%80%D0%B8%D0%B4%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85_%D0%BB%D0%B8%D1%86). 
* для использования сведений из ЕГРЮЛ в работе предусмотрено взаимодействие
с микро-сервисом [egrul_fts_api](https://github.com/PrudyvusP/egrul_fts_api) по API через форму поиска.  
* каждая организация и ее информационные ресурсы имеют географический адрес расположения (Address).
* любой адрес относится к определенному региону (Region) и округу (Okrug) соответственно.
Географические данные регионов и округов заполняются с помощью миграции данных, а данные адресов берутся из 
[Эталонного справочника почтовых индексов объектов почтовой связи АО "Почта России"](https://www.pochta.ru/support/database/ops)

Сервис написан на Flask преимущественно с использованием flask-admin. В качестве БД используется PostgreSQL.

### Переменные окружения
В корне проекта должен быть предусмотрен файл `.env`, в котором должны быть установлены
обязательно следующие переменные окружения:
`SECRET_KEY=<secret_key>`  
`FLASK_ENV=<development/testing/production>`  
`FLASK_APP=organizations`

В режиме **production** в качестве БД используется PostgreSQL, которая хочет видеть 
такие переменные окружения для подключения:
```bash
DB_HOST=<db_host>
DB_NAME=<db_name>
DB_PORT=<db_port>
POSTGRES_USER=<db_user>
POSTGRES_PASSWORD=<db_password>
```

### Использование

Клонировать проект
```bash
https://github.com/PrudyvusP/cert_ecosystem.git && cd "$(basename "$_" .git)"
```
Для быстрого развертывания предусмотрен скрипт setup.sh, который создаст виртуальное
окружение, загрузит необходимые зависимости, добавит необходимые переменные окружения
и осуществит миграции БД и зальет подготовленные географические сведения
```bash
bash setup.sh
```

### Management-команды

Команда index проверяет наличие обновления или обновляет БД сведениями
о почтовых индексах. На вход хочет получать файл вида ```PIndx*.dbf```, 
который загружается [отсюда](https://www.pochta.ru/support/database/ops).
```bash
flask index -f <path_to_file> check
flask index -f <path_to_file> update
```

